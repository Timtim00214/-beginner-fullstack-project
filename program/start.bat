@echo off
title AI聊天机器人启动器
color 0A

:: =================================================
:: 检查端口3901是否已被占用
:: =================================================
netstat -ano | findstr :3901 >nul
if %errorlevel% equ 0 (
    cls
    color 0C
    echo.
    echo ==========================================
    echo    ERROR: 错误：程序已在运行中！不要反复启动！
    echo ==========================================
    echo.
    echo    无需重复打开此程序
    echo    请检查任务栏中是否已有运行窗口
    echo.
    echo    按任意键关闭此窗口......
    pause >nul
    exit
)

:: =================================================
:: 正常启动流程
:: =================================================

echo ==========================================
echo      正在初始化环境，请稍候...
echo      (第一次运行需要下载组件，可能会慢一点)
echo ==========================================

:: 1. 自动安装依赖 (如果已安装会自动跳过)
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple

:: 2. 自动打开浏览器访问页面
:: start "" "frontend.html" <-- 如果是直接打开文件用这个
:: 但建议直接打开 localhost
echo.
echo 正在打开浏览器...
start "" "frontend.html"

:: 3. 启动服务器
echo.
echo ==========================================
echo     服务已启动
echo     请勿关闭此窗口
echo ==========================================
python main.py

pause
